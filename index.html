<!DOCTYPE html>
<!-- WELCOME! IF YOU ARE A BEGINNER READ THIS
    - Find and replace text inside text area with id = "code" with your python code
    - IMPORTANT: It's absolutely crucial that your python code within the text-area is indented correctly. 
    - This means you can't have space between <textarea>tags and start/end of your code 
        <textarea id="code">print("Welcome to the rollercoaster!")<textarea/> 
        observe how there's no spaces in start and end between code and tag
    - Put 'Await' before any input in python so height = int(input("What is your height?")) becomes height = int(await input("What is your height?"))
    - Feel free to change styles using css to suit your taste!
    - Save and tpublish, it's pretty simple, you can youtube how to put a simple html page on github
    - Have fun! 
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Python 3 Runner (Pyodide)</title>
  <style>
    body {
      margin: 0;
      font-family: monospace, monospace;
      background: #1e1e1e;
      color: #eee;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    #container {
      flex: 1;
      display: flex;
    }
    textarea {
      width: 50%;
      height: 100%;
      background: #2d2d2d;
      color: #cfcfcf;
      font-family: monospace;
      font-size: 1rem;
      padding: 1em;
      border: none;
      resize: none;
    }
    #output {
      width: 50%;
      height: 100%;
      background: #000;
      color: #0f0;
      font-family: monospace;
      font-size: 1rem;
      padding: 1em;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    button {
      padding: 1em;
      background: #3a3d41;
      border: none;
      color: white;
      font-size: 1rem;
      cursor: pointer;
    }
    button:hover {
      background: #505357;
    }
    .input-line {
      background: none;
      border: none;
      color: #0f0;
      font-family: monospace;
      font-size: 1rem;
      outline: none;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="container">
    <textarea id="code">print("Welcome to the rollercoaster!")
height = int(await input(" What is your height in cm? "))
bill = 0
if height >= 120:
    print("You can ride the rollercoaster!")
    age = int(await input(" What is your age? "))
    if age <= 12:
        bill = 5
        print(f"Your ticket is ${bill}")
    elif age <= 18:
        bill = 7
        print(f"Your ticket is ${bill}")
    else:
        bill = 10
        print(f"Your ticket is ${bill}")
    photo_charge = 0
    photo_answer = (await input("Would you like a photo service for extra price of $3?(y/n): ")).lower()
    if photo_answer == "y" or photo_answer == "yes":
        photo_charge += 3
        print("You have chosen to opt-in for the photo service")
    elif photo_answer == "n" or photo_answer == "no":
        print("You have chosen to skip the photo service")
    else:
        print("sorry your input was invalid, please type 'y' for yes and 'n' for no")
        photo_answer = (await input("Would you like a photo service for extra price of $3?(y/n): ")).lower()
        if photo_answer == "y" or photo_answer == "yes":
            photo_charge += 3
            print("You have chosen to opt-in for the photo service")
        elif photo_answer == "n" or photo_answer == "no":
            print("You have chosen to skip the photo service")
        else:
            print("You put wrong answer twice, the program is terminated, please try again with valid inputs thanks!")
            exit()
    print(f"Your total bill is Ticket(${bill}) + Extra Charge(${photo_charge}) = ${bill + photo_charge}")
else:
    print("Sorry you have to grow taller before you can ride.Come back later!")</textarea>
    <div id="output"></div>
  </div>
  <button id="run">Run</button>

  <!-- Load Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
  <script>
    let pyodideReadyPromise = loadPyodide();

    async function customInput(promptText) {
      const outputDiv = document.getElementById("output");
      outputDiv.innerHTML += promptText;

      const inputField = document.createElement("input");
      inputField.type = "text";
      inputField.className = "input-line";
      outputDiv.appendChild(inputField);
      inputField.focus();

      return new Promise((resolve) => {
        inputField.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            const value = inputField.value;
            outputDiv.removeChild(inputField);
            outputDiv.innerHTML += value + "\n";
            resolve(value);
          }
        });
      });
    }

    document.getElementById("run").addEventListener("click", async () => {
      const code = document.getElementById("code").value;
      const outputDiv = document.getElementById("output");
      outputDiv.textContent = "Running...\n";

      const pyodide = await pyodideReadyPromise;

      pyodide.setStdout({
        batched: (text) => {
          outputDiv.textContent += text;
          outputDiv.scrollTop = outputDiv.scrollHeight;
        },
      });
      pyodide.setStderr({
        batched: (text) => {
          outputDiv.textContent += text;
          outputDiv.scrollTop = outputDiv.scrollHeight;
        },
      });

      // Expose custom async input
      pyodide.globals.set("input", customInput);

      try {
        await pyodide.runPythonAsync(code, { globals: pyodide.globals });
      } catch (err) {
        outputDiv.textContent += "\nError:\n" + err;
      }
    });
  </script>
</body>
</html>
