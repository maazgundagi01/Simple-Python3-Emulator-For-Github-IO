<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Python 3 Runner (Pyodide)</title>
  <style>
    
  </style>
</head>
<body>
  <div id="container">
    <textarea id="code">
    print("Welcome to the rollercoaster!")
height = int(await input("What is your height in cm? "))
bill = 0
if height >= 120:
    print("You can ride the rollercoaster!")
    age = int(await input("What is your age? "))
    if age <= 12:
        bill = 5
        print(f"Your ticket is ${bill}")
    elif age <= 18:
        bill = 7
        print(f"Your ticket is ${bill}")
    else:
        bill = 10
        print(f"Your ticket is ${bill}")
else:
    print("Sorry you have to grow taller before you can ride.")
    exit()

photo_charge = 0
photo_answer = (await input("Would you like a photo service for extra price of $3?(y/n): ")).lower()
if photo_answer == "y" or photo_answer == "yes":
    photo_charge += 3
    print("You have chosen to opt-in for the photo service")
elif photo_answer == "n" or photo_answer == "no":
    print("You have chosen to skip the photo service")

print(f"Your total bill is Ticket(${bill}) + Extra Charge(${photo_charge}) = ${bill + photo_charge}")</textarea>
    <div id="output"></div>
  </div>
  <button id="run">Run</button>

  <!-- Load Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
  <script>
    let pyodideReadyPromise = loadPyodide();

    async function customInput(promptText) {
      const outputDiv = document.getElementById("output");
      outputDiv.innerHTML += promptText;

      const inputField = document.createElement("input");
      inputField.type = "text";
      inputField.className = "input-line";
      outputDiv.appendChild(inputField);
      inputField.focus();

      return new Promise((resolve) => {
        inputField.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            const value = inputField.value;
            outputDiv.removeChild(inputField);
            outputDiv.innerHTML += value + "\n";
            resolve(value);
          }
        });
      });
    }

    document.getElementById("run").addEventListener("click", async () => {
      const code = document.getElementById("code").value;
      const outputDiv = document.getElementById("output");
      outputDiv.textContent = "Running...\n";

      const pyodide = await pyodideReadyPromise;

      pyodide.setStdout({
        batched: (text) => {
          outputDiv.textContent += text;
          outputDiv.scrollTop = outputDiv.scrollHeight;
        },
      });
      pyodide.setStderr({
        batched: (text) => {
          outputDiv.textContent += text;
          outputDiv.scrollTop = outputDiv.scrollHeight;
        },
      });

      // Expose custom async input
      pyodide.globals.set("input", customInput);

      try {
        await pyodide.runPythonAsync(code, { globals: pyodide.globals });
      } catch (err) {
        outputDiv.textContent += "\nError:\n" + err;
      }
    });
  </script>
</body>
</html>
